<?xml version="1.0" encoding="utf-8" ?>
<project name="pigiron-master-build" default="all" basedir=".">

    <description>
    The PigIron Project
    Open Source Client, Servlet and Web 2.0 Navigator for IBM z/VM SMAPI
    Copyright *C* 2008,2009
    Jack J. Woehr
    PO Box 51 Golden, Colorado 80402 USA
    http://pigiron.sourceforge.net
    http://www.softwoehr.com
    
    No Warranty No Guarantee Open Source.
    Please read the file license.txt.
    
    =========================
    PigIron master build file
    =========================
    
    PigIron was conceived in three parts,pigiron, piglet and pigview.
    Each has its own Ant build.xml. This is overall build.xml file
    which juggles targets from the individual projects.
    </description>

    <property location="${basedir}/../pigiron" name="pigiron.dir"></property>
    <property location="${basedir}/../piglet" name="piglet.dir"></property>
    <property location="${basedir}/../pigview" name="pigview.dir"></property>
    <property location="${basedir}/../dist" name="dist.dir"></property>
    <property location="${basedir}/../dist/doc" name="doc.dir"></property>
    <property location="${doc.dir}/javadoc" name="javadoc.dir"></property>
    <property location="${pigiron.dir}/src" name="pigiron.java.src.dir"></property>
    <property location="${piglet.dir}/src/java" name="piglet.java.src.dir"></property>
    <property location="${pigview.dir}/src" name="pigview.java.src.dir"></property>
    <property location="${pigiron.dir}/dist" name="pigiron.dist.dir"></property>
    <property location="${piglet.dir}/dist" name="piglet.dist.dir"></property>

    <target name="all" depends="build,javadocs,distrib" description="Build and package all components for deployment and distribution"/>

    <target name="build" depends="pigiron,pigview,piglet" description="Build PigIron, PigView and PigLet"/>

    <target name="pigiron" description="Build PigIron Open Source Java client for IBM z/VM SMAPI">
        <ant dir="${pigiron.dir}" inheritall="false" inheritrefs="false" target="build"/>
    </target>

    <target name="pigview" description="Build the PigView Web 2.0 Navigator and insert it in PigLet web dir hierarchy for inclusion in PigLet .war file">
        <ant dir="${pigview.dir}" inheritall="false" inheritrefs="false" target="build"/>
        <ant dir="${pigview.dir}" inheritall="false" inheritrefs="false" target="piglet"/>
    </target>

    <target name="piglet" description="Build the PigLet PigIron Servlet and its .war file">
        <ant dir="${piglet.dir}" inheritall="false" inheritrefs="false" target="build"/>
    </target>

    <target name="clean" depends="clean-distdir" description="Cleans the overall project's intermediate and output files">
        <ant dir="${pigiron.dir}" inheritall="false" inheritrefs="false" target="clean"/>
        <ant dir="${piglet.dir}" inheritall="false" inheritrefs="false" target="clean"/>
        <ant dir="${pigview.dir}" inheritall="false" inheritrefs="false" target="clean"/>
    </target>

    <target name="clean-distdir" description="Cleans the overall project's build dirs">
        <delete dir="${dist.dir}"/>
    </target>

    <target name="javadocs" description="Generate composite javadocs for all PigIron projects">
        <mkdir dir="${javadoc.dir}"/>
        <javadoc destdir="${javadoc.dir}">
            <sourcefiles>
                <fileset dir="${pigiron.java.src.dir}" defaultexcludes="yes"/>
                <fileset dir="${piglet.java.src.dir}" defaultexcludes="yes"/>
                <fileset dir="${pigview.java.src.dir}" defaultexcludes="yes"/>
            </sourcefiles>
        </javadoc>
    </target>

    <!-- ~~~~~~~~~~~~ -->
    <!-- Distribution -->
    <!-- ~~~~~~~~~~~~ -->

    <target name="distrib" depends="-distrib-copy,-distrib-zip" description="Builds a distribution for all PigIron projects as one archive">
        <echo message="Remember that distrib is not a fully implemented target yet."/>
    </target>

    <target name="-distrib-copy">
        <copy file="${pigiron.dist.dir}/pigiron.jar" todir="${dist.dir}"/>
        <copy file="${piglet.dist.dir}/piglet.war" todir="${dist.dir}"/>
    </target>

    <target name="-distrib-zip">
        <zip basedir="${dist.dir}" destfile="${dist.dir}/pigiron-all.zip" includes="doc/**,*.war,*.jar"/>
    </target>

</project>
